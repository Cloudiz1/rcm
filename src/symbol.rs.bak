use crate::parser;
use std::collections::HashMap;

#[derive(Debug, Clone)]
pub enum Symbol {
    Function {
        params: Vec<parser::Type>,
        ret: parser::Type,
        public: bool,
        size: usize,
    },
    Variable {
        variable_type: Option<parser::Type>,
        constant: bool,
        public: bool,
        size: usize,
    },
    Enum {
        varients: Vec<String>,
        public: bool,
        typedef: parser::Type,
        size: usize,
    },
    Struct {
        members: HashMap<String, Symbol>, // Symbol::Variable
        methods: HashMap<String, Symbol>, // Symbol::Function
        public: bool,
        typedef: parser::Type,
        size: usize,
    },
}

pub trait Type {
    fn get_type(&self) -> Option<parser::Type>;
    fn get_size(&self) -> Option<usize>;
}

impl Type for Symbol {
    fn get_type(&self) -> Option<parser::Type> {
        match self {
            Symbol::Variable {
                variable_type,
                constant: _,
                public: _,
                size: _,
            } => (*variable_type).clone(),
            Symbol::Function {
                params: _,
                ret,
                public: _,
                size: _,
            } => Some((*ret).clone()),
            Symbol::Enum {
                varients: _,
                public: _,
                typedef,
                size: _,
            } => Some((*typedef).clone()),
            Symbol::Struct {
                members: _,
                methods: _,
                public: _,
                typedef,
                size: _,
            } => Some((*typedef).clone()),
        }
    }

    fn get_size(&self) -> Option<usize> {
        match self {
            Symbol::Variable {
                variable_type: _,
                constant: _,
                public: _,
                size,
            } => Some(*size),
            Symbol::Function {
                params: _,
                ret: _,
                public: _,
                size,
            } => Some(*size),
            Symbol::Enum {
                varients: _,
                public: _,
                typedef: _,
                size,
            } => Some(*size),
            Symbol::Struct {
                members: _,
                methods: _,
                public: _,
                typedef: _,
                size,
            } => Some(*size),
        }
    }
}
